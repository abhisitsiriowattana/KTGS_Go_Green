<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>KTGS Go Green - Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://static.line-scdn.net/liff/edge/versions/2.27.0/sdk.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #e7f7ff;
      font-family: 'Sarabun', Arial, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .phone-frame {
      background: #f2faff;
      width: 100vw;
      max-width: 500px;
      min-height: 100vh;
      border-radius: 32px 32px 0 0;
      overflow: hidden;
      box-shadow: 0 4px 32px #8ed6ff22;
      position: relative;
      border: 1.5px solid #b5e2fa;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .top-bar {
      width: 100%;
      background: #5dc9ff;
      color: #fff;
      padding: 13px 0 4px 0;
      text-align: right;
      font-size: 0.88em;
      position: relative;
      display: flex;
      box-sizing: border-box;
      min-height: 80px;
      align-items: center;
      justify-content: center;
      flex-direction: row;
    }
    .top-bar .left {
      flex: 1;
      text-align: -webkit-auto;
      padding-left: 28px;
      font-size: 1.15em;
      font-weight: 700;
      letter-spacing: 3.1px;
      opacity: 0.85;
    }
    .top-bar .left {
    flex: 1;
    text-align: left;
    padding-left: 28px;
    font-size: 1.15em;
    font-weight: 700;
    letter-spacing: 1px;
    opacity: 0.85;
    }
    .top-bar .right {
    flex: 0 0 60px;
    display: flex;
    align-items: flex-start;
    height: 100%;
    padding-right: 14px;
    justify-content: flex-end;
    }
    .back-circle-btn {
      background: #5d4c4c3b;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 10px #5dc9ff33;
      border: none;
      cursor: pointer;
      margin-top: 8px;
      transition: background 0.15s;
      outline: none;
    }
    .back-circle-btn:active {
      background: #b5e2fa;
    }
    .back-circle-btn img {
      width: 22px;
      height: 22px;
      display: block;
    }
    .carousel {
    margin: 18px 0 18px 0;
    width: 100%;
    max-width: 495px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    }
    .carousel-img {
      width: 100%;
      border-radius: 18px;
      box-shadow: 0 2px 12px #b5e2fa33;
      overflow: hidden;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 220px;
      cursor: pointer;
      position: relative;
      background: #d7eefd;
    }
    .carousel-img img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      border-radius: 18px;
      background: #e7f7ff;
      transition: filter 0.15s;
      display: block;
    }
    .carousel-dots {
      margin: 2px 0 0 0;
      display: flex;
      justify-content: center;
      gap: 7px;
    }
    .carousel-dot {
      width: 10px;
      height: 10px;
      background: #b5e2fa;
      border-radius: 50%;
      display: inline-block;
      opacity: 0.7;
      transition: background 0.2s;
      cursor: pointer;
      border: none;
      outline: none;
    }
    .carousel-dot.active {
      background: #1e90ff;
      opacity: 1;
    }

    .profile-card {
      background: linear-gradient(135deg, #4bbcf7 20%, #16e2a1 100%);
      color: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 16px #b5e2fa33;
      padding: 13px 13px 13px 13px;
      margin: 0 0 16px 0;
      width: 100%;
      max-width: 459px;
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 0px;
      min-height: 48px;
      align-items: flex-start;
      justify-content: center;
      font-size: 1.13em;
      font-weight: bold;
      letter-spacing: 0.01em;
    }
    .profile-card .branch {
      font-size: 1.19em;
      font-weight: 700;
      letter-spacing: 0.04em;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    .profile-card .branch .icon {
      font-size: 1.14em;
      margin-left: 4px;
    }
    .profile-card-row {
      font-size: 1.09em;
      margin-bottom: 2px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .profile-card-row .label {
      font-weight: 600;
      color: #eafff4;
      opacity: 0.93;
    }
    .profile-card-row .value {
      font-weight: 700;
      color: #fff;
    }
    .profile-card-row .bold {
      font-weight: bold;
    }
    .profile-card .status {
      font-weight: 700;
      color: #0acb7e;
      background: #e7fff7;
      border-radius: 8px;
      padding: 2.5px 10px;
      margin-left: 8px;
      font-size: 0.98em;
    }
    .profile-card .userid {
      color: #1e90ff;
      background: #fff;
      border-radius: 8px;
      padding: 2.5px 9px;
      font-size: 0.98em;
      font-weight: bold;
      margin-left: 8px;
      letter-spacing: 0.04em;
    }
    .profile-img-nav {
      width: 32px;
      height: 32px;
      margin-top: 24px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #fff;
      box-shadow: 0 1px 6px #b5e2fa80;
      background: #fff;
      z-index: 2;
      display: block;
    }
    .section-carousel {
      width: 100%;
      max-width: 495px;
      border-radius: 17px;
      background: #e7f7ff00;
      margin: 0 0 0.1px 0;
      overflow: hidden;
      box-shadow: 0 2px 10px #b5e2fa22;
      display: flex;
      flex-direction: row;
      position: relative;
      align-items: center;
      align-content: center;
      justify-content: center;
      flex-wrap: wrap;
    }
    .section-carousel-img {
      width: 100%;
      border-radius: 18px;
      height: 188px;
      background: #e7f7ff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      cursor: pointer;
      position: relative;
    }
    .section-carousel-img img {
      width: 100%;
      height: 188px;
      object-fit: cover;
      border-radius: 18px;
      background: #e7f7ff;
      transition: filter 0.15s;
      display: block;
    }
    .section-carousel-dots {
      margin: 2px 0 0 0;
      display: flex;
      justify-content: center;
      gap: 7px;
    }
    .section-carousel-dot {
      width: 10px;
      height: 10px;
      background: #b5e2fa;
      border-radius: 50%;
      display: inline-block;
      opacity: 0.7;
      transition: background 0.2s;
      cursor: pointer;
      border: none;
      outline: none;
    }
    .section-carousel-dot.active {
      background: #1e90ff;
      opacity: 1;
    }

    /* --- NEW BOTTOM NAVIGATION --- */
    .bottom-nav {
      width: 100vw;
      max-width: 500px;
      background: #80d9ff;
      height: 88px;
      border-radius: 36px 36px 0 0;
      position: fixed;
      left: 50%;
      bottom: 0;
      transform: translateX(-50%);
      box-shadow: 0 1px 18px #b5e2fa77;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      z-index: 99;
      padding: 0;
    }
    .nav-btn {
      flex: 1 1 0;
      height: 100%;
      background: none;
      border: none;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      cursor: pointer;
      position: relative;
      margin: 0;
      padding: 0;
      transition: filter 0.13s;
      z-index: 1;
      align-items: center;
      flex-direction: column;
      align-content: center;
      flex-wrap: wrap;
    }
    /* Support & Profile move to edge */
    .nav-btn.left-edge {
      align-items: flex-start;
      padding-left: 8px;
    }
    .nav-btn.right-edge {
      align-items: flex-end;
      padding-right: 8px;
    }
    /* Home Active: white circle above nav bar */
    .nav-btn .nav-circle {
      width: 88px;
      height: 88px;
      background: #fff;
      border-radius: 50%;
      position: absolute;
      left: 50%;
      bottom: 20.5px;
      transform: translate(-50%, 0);
      z-index: 10;
      box-shadow: 0 2px 10px #b5e2fa40;
      display: none;
    }
    .nav-btn.active .nav-circle {
      display: flex;
    }
    /* Home Active: blue circle centered in white circle */
    .nav-btn .nav-centered {
      width: 69.46px;
      height: 69.46px;
      background: #80d9ff;
      border-radius: 50%;
      position: absolute;
      left: 50%;
      bottom: 30.5px;
      /* perfectly middle of .nav-circle (88px - 69.5px)/2 = 9.25px, 62px+9.25px=71.25, but visually 76.5px better for shadow */
      transform: translate(-50%, 0);
      z-index: 11;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 5px 18px #b5e2fa66;
    }
    .nav-btn.active .nav-centered {
      display: flex;
    }
    /* Home Active: icon and label inside blue circle */
    .nav-btn.active .nav-centered .nav-icon {
      width: 38px;
      height: 38px;
      object-fit: contain;
      margin: 0 auto 2px auto;
      z-index: 12;
    }
    .nav-label {
      font-weight: bold;
      color: #ffffff;
    }
    .nav-btn.active .nav-centered .nav-label {
      margin: 0;
      font-size: 1.11em;
      opacity: 1;
      text-shadow: 0 1px 8px #1e90ff22;
      letter-spacing: 0.01em;
      z-index: 13;
      line-height: 1.1;
    }
    /* Inactive: icon/label below nav bar */
    .nav-btn:not(.active) .nav-icon {
      width: 32px;
      height: 32px;
      margin-top: 24px;
      filter: brightness(0) invert(1) opacity(0.72);
      z-index: 2;
    }
    .nav-btn:not(.active) .nav-label {
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      align-content: center;
      align-items: center;
    }
    @media (max-width: 600px) {
      .bottom-nav { max-width: 100vw; }
      .nav-btn .nav-circle { width: 64px; height: 65px; bottom: 47px; }
      .nav-btn .nav-centered { width: 48px; height: 48px; bottom: 57px; }
      .nav-btn.active .nav-centered .nav-icon { width: 22px; height: 22px; }
      .nav-btn:not(.active) .nav-icon { width: 18px; height: 18px; }
      .nav-btn.left-edge { padding-left: 1vw; }
      .nav-btn.right-edge { padding-right: 1vw; }
    }
  </style>
</head>
<body>
  <div class="phone-frame">
    <div class="top-bar">
      <div class="left" id="topBarTime">--:--</div>
      <div class="center">Welcome to "KTGS Go Green"</div>
      <div class="right">
        <button class="back-circle-btn" onclick="liff.closeWindow()">
          <img src="https://i.postimg.cc/3xZsp2cY/bx-back.png" alt="Back" />
        </button>
      </div>
    </div>

    <!-- Carousel -->
    <div class="carousel" id="mainCarousel"></div>

    <!-- Profile Card -->
    <div class="profile-card" id="profileCard">
      <div class="branch">Branch : <span class="bold" id="branchValue">-</span></div>
      <div class="profile-card-row">
        <span class="label">Name :</span> <span class="value" id="nameValue">-</span>
        <span class="label">Surname :</span> <span class="value" id="surnameValue">-</span>
      </div>
      <div class="profile-card-row">
        <span class="label">Department :</span> <span class="value bold" id="deptValue">-</span>
      </div>
      <div class="profile-card-row">
        <span class="label">Position :</span> <span class="value" id="posValue">-</span>
        <span class="label">User ID :</span> <span class="userid" id="userIdValue">-</span>
      </div>
      <div class="profile-card-row">
        <span class="label">Activity Code :</span> <span class="value" id="actCodeValue">-</span>
        <span class="label">Status :</span> <span class="status" id="statusValue">-</span>
      </div>
    </div>

    <!-- Section Carousel (single image with link) -->
    <div class="section-carousel" id="sectionCarousel"></div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <button class="nav-btn left-edge" onclick="location.href='support.html'">
      <img class="nav-icon" src="https://i.postimg.cc/FKNMVz1P/bx-support.png" alt="Support"/>
      <span class="nav-label">Support</span>
    </button>
    <button class="nav-btn" onclick="location.href='chat.html'">
      <img class="nav-icon" src="https://i.postimg.cc/gjssdcG0/bx-report.png" alt="Chat"/>
      <span class="nav-label">Report</span>
    </button>
    <button class="nav-btn active" onclick="window.location.href='https://liff.line.me/2007678556-w9jamgJY'">
      <span class="nav-circle"></span>
      <span class="nav-centered">
        <img class="nav-icon" src="https://i.postimg.cc/fRxKNByq/Vector.png" alt="Home"/>
        <span class="nav-label">Home</span>
      </span>
    </button>
    <button class="nav-btn" onclick="location.href='notify.html'">
      <img class="nav-icon" src="https://i.postimg.cc/K8BKgqgP/bx-notify.png" alt="Notify"/>
      <span class="nav-label">Notify</span>
    </button>
    <button class="nav-btn right-edge" id="profileNavBtn" onclick="">
      <img id="profileNavImg" class="nav-icon profile-img-nav" src="https://i.postimg.cc/yYx2r6wF/profile-2.png" alt="Profile"/>
      <span class="nav-label">Profile</span>
    </button>
  </div>
  <script>

    // === CONFIG ===
    // เปลี่ยน LIFF_ID ให้เป็น LIFF ID ที่ตั้ง Endpoint URL เป็น liff-home.html บน GitHub Pages
    const LIFF_ID = "2007678556-w9jamgJY"; // <--- ใส่ LIFF ID ของหน้า home ที่ตั้ง endpoint เป็น github
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzyFGNW06_ky5ZvmKHMcGGbLbuEpxgeLdqaR1665JRKnOoksXKxNav-ez3PbNBFFt6HxA/exec";
    // เปลี่ยน LOGIN_LIFF_ID ให้เป็น LIFF ID ที่ตั้ง endpoint เป็น liff-login.html บน GitHub Pages (หรือ OA เดิม)
    const LOGIN_LIFF_ID = "2007677132-Z38g9kmn"; // <--- ใส่ LIFF ID ของหน้า login

    // --- Top bar time ---
    function updateTime() {
      const now = new Date();
      const h = now.getHours().toString().padStart(2, "0");
      const m = now.getMinutes().toString().padStart(2, "0");
      document.getElementById('topBarTime').textContent = `${h}:${m}`;
    }
    updateTime();
    setInterval(updateTime, 10000);

    // --- LIFF Login/Profile Image ---
    async function checkLiffLoginAndProfile() {
      try {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isInClient()) {
          alert("โปรดเปิดหน้านี้ผ่านแอป LINE เท่านั้น");
          return false;
        }
        if (!liff.isLoggedIn()) {
          liff.login();
          return false;
        }
        const profile = await liff.getProfile();
        if (profile.pictureUrl) {
          const img = document.getElementById('profileNavImg');
          img.src = profile.pictureUrl;
          img.alt = profile.displayName;
        }
        document.getElementById('profileNavBtn').onclick = function() {
          window.location.href = 'profile.html';
        };
        return true;
      } catch (e) {
        alert("เกิดข้อผิดพลาดในการเข้าสู่ LIFF: " + e.message);
        return false;
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      await checkLiffLoginAndProfile();
      renderMainCarousel();
      renderSectionCarousel();
      loadProfileCard();
    });

    // --- Carousel data (banner) ---
    const banners = [
      {
        img: "https://www.ktbgs.co.th/wp-content/uploads/2025/02/68-02-27-banner-warning-scammer-call-center-scaled.jpg",
        link: "https://www.ktbgs.co.th/ktbgs-news/warning-to-scammer-call-center/"
      },
      {
        img: "https://www.ktbgs.co.th/wp-content/uploads/2025/03/KTGS_1659-CAC-anticorruption-scaled.jpg",
        link: "https://www.ktbgs.co.th/ktbgs-news/cac-anti-corruption/"
      },
      {
        img: "https://www.ktbgs.co.th/wp-content/uploads/2023/05/banner-%E0%B9%80%E0%B8%9B%E0%B8%B4%E0%B8%94%E0%B8%A3%E0%B8%B1%E0%B8%9A%E0%B8%AA%E0%B8%A1%E0%B8%B1%E0%B8%84%E0%B8%A3%E0%B8%87%E0%B8%B2%E0%B8%99-v-02-2500px-3-revise2-02-scaled.jpg",
        link: "https://www.ktbgs.co.th/careers/opening-positions/"
      },
      {
        img: "https://www.ktbgs.co.th/wp-content/uploads/2021/05/ktbgs-chemical-protection-cleaning-Covid-2021.jpg",
        link: "https://www.ktbgs.co.th/ktbgs-news/chemical-protection-cleaning/"
      },
      {
        img: "https://www.ktbgs.co.th/wp-content/uploads/2018/09/Service1-1.jpg",
        link: "https://www.ktbgs.co.th/services/cash-logistic/"
      },
      {
        img: "https://www.ktbgs.co.th/wp-content/uploads/2018/09/20180606_06-07-57_C24_5633.jpg",
        link: "https://www.ktbgs.co.th/services/security/"
      },                  
      {
        img: "https://www.ktbgs.co.th/wp-content/uploads/2019/05/20180606_08-01-09_V56_3547_edit.jpg",
        link: "https://www.ktbgs.co.th/services/cleaning/"
      }
    ];
    let mainCarouselIndex = 0;
    function renderMainCarousel() {
      const carouselDiv = document.getElementById('mainCarousel');
      carouselDiv.innerHTML = `
        <div class="carousel-img" id="mainCarouselImg" onclick="window.open('${banners[mainCarouselIndex].link}','_blank')">
          <img src="${banners[mainCarouselIndex].img}" alt="Banner"/>
        </div>
        <div class="carousel-dots">${banners.map((_,i)=>`<span class="carousel-dot${i===mainCarouselIndex?' active':''}" onclick="setMainCarouselIndex(${i})"></span>`).join('')}</div>
      `;
    }
    function setMainCarouselIndex(i) {
      mainCarouselIndex = i;
      renderMainCarousel();
    }
    function mainCarouselNext() {
      mainCarouselIndex = (mainCarouselIndex + 1) % banners.length;
      renderMainCarousel();
    }
    setInterval(mainCarouselNext, 5000);

    // --- Section Carousel (single image with link) --
    const sectionBanner = {
      img: "https://i.postimg.cc/xdV4DDFN/LINE-Rich-Menu.png",
      link: "https://liff.line.me/2007678556-w9jamgJY/liff-camera.html"
    };
    function renderSectionCarousel() {
      const carouselDiv = document.getElementById('sectionCarousel');
      carouselDiv.innerHTML = `
        <div class="section-carousel-img" onclick="window.open('${sectionBanner.link}','_blank')">
          <img src="${sectionBanner.img}" alt="Section"/>
        </div>
      `;
    }

    // --- Back-Circle-Icon --
    function handleBack() {
       if (window.liff && liff.isInClient()) {
        liff.closeWindow();
        } else {
          alert("โปรดใช้งานในแอป LINE เพื่อกลับไปหน้าหลัก");
           }
  }

    // --- Profile Card Data from Google Sheet ---
    async function loadProfileCard() {
      function getQueryParam(param) {
        const url = new URL(window.location.href);
        return url.searchParams.get(param) || "";
      }
      const empId = getQueryParam("empId");
      const lineUserId = getQueryParam("lineUserId");
      if (!empId && !lineUserId) return;
      const SHEET_API = GAS_URL;
      try {
        const res = await fetch(SHEET_API + "?action=getUserProfile&empId=" + encodeURIComponent(empId) + "&lineUserId=" + encodeURIComponent(lineUserId));
        const data = await res.json();
        if (data && data.status === "ok" && data.user) {
          const userProfile = data.user;
          document.getElementById('branchValue').innerText = userProfile.N || "-";
          document.getElementById('nameValue').innerText = ((userProfile.C||"")+(userProfile.D?" "+userProfile.D:"")) || "-";
          document.getElementById('surnameValue').innerText = userProfile.E || "-";
          document.getElementById('deptValue').innerText = userProfile.K || "-";
          document.getElementById('posValue').innerText = userProfile.I || "-";
          document.getElementById('userIdValue').innerText = userProfile.X || "-";
          document.getElementById('actCodeValue').innerText = userProfile.O || "-";
          document.getElementById('statusValue').innerText = userProfile.S || "-";
        }
      } catch (e) {}
    }
  </script>
</body>
</html>
